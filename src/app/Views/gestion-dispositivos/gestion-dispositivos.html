<div class="gestion-container">
  <h2>GestiÃ³n de Dispositivos</h2>
<div class="dispflex">
    <!-- ðŸ”½ Filtro por tipo de dispositivo -->
<div class="acciones-superiores2 nodisplay">
    <mat-form-field appearance="outline" class="filter-item tdis">
      <mat-label >Tipo Dispositivo</mat-label>
      <mat-select [(value)]="tipoSeleccionado" (selectionChange)="aplicarFiltros()"  (change)="aplicarFiltros()" >
        <mat-option value="Todos">--</mat-option>
        @for (m of deviceTypes(); track m) {
        <mat-option [value]="m.idTipoDispositivo">{{ m.nombre }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" class="filter-item area">
      <mat-label>Area</mat-label>
      <mat-select [(value)]="TipoArea" (selectionChange)="aplicarFiltros()"  (change)="aplicarFiltros()">
        <mat-option value="Todos">--</mat-option>
        @for (m of Areas(); track m) {
        <mat-option [value]="m.idArea">{{ m.nombre }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
    </div>
    <!-- ðŸ”½ Barra de bÃºsqueda -->
  <div class="buscador">
    <input 
      type="text" 
      placeholder="Buscar por nombre..."
      [(ngModel)]="terminoBusqueda"
      (input)="aplicarFiltros()">
  </div>
  <div class="acciones-superiores">
    @if(isAdmin()){
    <button class="btn-agregar" (click)="agregarDispositivo()">âž• Agregar Dispositivo</button>}
    <button class="btn-horario" (click)="irAHorarios()">ðŸ•’ Horario Dosificador</button>
  </div>


</div>


  <!-- ðŸ”½ Tabla de dispositivos -->
  <table class="tabla-dispositivos">
  <thead>
    <tr>
      <th class="nodisplay">NÂ°</th>
      <th>Nombre</th>
      <th class="nodisplay">Sistema</th>
      <th>Estado</th>
      <th>Tipo de Dispositivo</th>
      <th><p class="nodisp">Acciones</p></th> <!-- âœ… Nueva columna -->
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let dispositivo of dispositivosFiltrados() | paginate: { itemsPerPage:7, currentPage: paginaActual }; let i = index">

      <td class="nodisplay">{{ i + 1 }}</td>
      <td>{{ dispositivo.nombre }}</td>
      <td class="nodisplay">{{ dispositivo.sistema || '-' }}</td>
      <td>
        <span 
          [ngClass]="{
            'estado-on': dispositivo.idEstadoDispositivoNavigation?.nombre === 'ON', 
            'estado-off': dispositivo.idEstadoDispositivoNavigation?.nombre === 'OFF'
          }">
          {{ dispositivo.estado || '-' }}
        </span>
      </td>
      <td>{{ dispositivo.idTipoDispositivoNavigation?.nombre || '-' }}</td>
      <td class="acciones"> <!-- âœ… Botones trasladados aquÃ­ -->
        <button class="btn-editar" (click)="editarDispositivo(dispositivo)">
          <i class="material-icons">edit</i>
        </button>
        
    @if(isAdmin()){
        <button class="btn-eliminar" (click)="eliminarDispositivo(dispositivo)">
          <i class="material-icons">delete</i>
        </button>}
      </td>
    </tr>
  </tbody>
</table>
<!-- ðŸ”½ PaginaciÃ³n -->
<pagination-controls 
  (pageChange)="paginaActual = $event"
  previousLabel="Anterior"
  nextLabel="Siguiente"
  class="paginador">
</pagination-controls>

  <!-- ðŸ”½ Modal -->
  <div class="modal" *ngIf="mostrarModal">
    <div class="modal-content">
      <span class="close" (click)="cerrarModal()">&times;</span>
      <h3>InformaciÃ³n del Dispositivo</h3>
      <p><strong>ID:</strong> {{ dispositivoSeleccionado?.idDispositivo }}</p>
      <p><strong>Nombre:</strong> {{ dispositivoSeleccionado?.nombre }}</p>
      <p><strong>Sistema:</strong> {{ dispositivoSeleccionado?.idSistemaNavigation?.nombre }}</p>
      <p><strong>Tipo:</strong> {{ dispositivoSeleccionado?.idTipoDispositivoNavigation?.nombre }}</p>
      <p><strong>Estado:</strong> {{ dispositivoSeleccionado?.idEstadoDispositivoNavigation?.nombre }}</p>
    </div>
  </div>
</div>
