<div class="container">
  <div class="sidebar">
    <img src="assets/logolestoma.jpg" alt="Logo" class="logo" />
    <div class="user-info">
      <span class="icon">👤</span>
      <p>Pedro Suarez</p>
      <p>Pedro543gmail.com</p>
    </div>
    <nav class="nav">
      <a routerLink="/inicio">🏠 Inicio</a>
      <a routerLink="/gestion-dispositivos">🧰 Gestión de Dispositivos</a>
      <a routerLink="/usuarios">👥 Usuarios</a>
      <a routerLink="/eventos">📋 Eventos</a>
      <a routerLink="/auditorias">🔍 Auditorías</a>
      <a routerLink="/notificaciones">🔔 Notificaciones</a>
    </nav>
    <a class="logout" routerLink="/login">🚪 Cerrar sesión</a>
  </div>

  <div class="form-container">
    <h1>Agregar Dispositivo</h1>
    <form (ngSubmit)="guardarDispositivo()" #formDispositivo="ngForm">
      <label>Nombre:</label>
      <input type="text" [(ngModel)]="dispositivo.nombre" name="nombre" required />

      <label>Serial:</label>
      <input type="text" [(ngModel)]="dispositivo.sn" name="sn" required />

      <label>Descripción:</label>
      <textarea [(ngModel)]="dispositivo.descripcion" name="descripcion"></textarea>

      <label>Imagen (URL):</label>
      <input type="text" [(ngModel)]="dispositivo.image" name="image" />

      <label>Marca:</label>
      <select [(ngModel)]="dispositivo.idMarca" name="marca" required>
        @for (marca of (marcas$ | async); track marca.idMarca) {
          <option [value]="marca.idMarca">{{ marca.nombre }}</option>
        }
      </select>

      <label>Sistema:</label>
      <select [(ngModel)]="dispositivo.idSistema" name="sistema" required>
        @for (sistema of (sistemas$ | async); track sistema.idSistema) {
          <option [value]="sistema.idSistema">{{ sistema.nombre }}</option>
        }
      </select>

      <label>Tipo de Dispositivo:</label>
      <select [(ngModel)]="dispositivo.idTipoDispositivo" name="tipoDispositivo" required (change)="onTipoDispositivoChange()">
        @for (tipo of (tiposDispositivo$ | async); track tipo.idTipoDispositivo) {
          <option [value]="tipo.idTipoDispositivo">{{ tipo.nombre }}</option>
        }
      </select>

      <!-- 🔹 Si es Sensor -->
      @if (tipoSeleccionadoNombre === 'sensor') {
        <label>Número de Mediciones:</label>
        <select [(ngModel)]="numeroMediciones" name="numeroMediciones" (change)="onNumeroMedicionesChange()">
          <option [value]="1">1</option>
          <option [value]="2">2</option>
        </select>

        <!-- Render dinámico según número seleccionado -->
        @for (i of [].constructor(numeroMediciones); let idx = $index; track idx) {
          <label>Tipo de Medición {{ idx + 1 }}:</label>
          <select [(ngModel)]="mediciones[idx]" [name]="'medicion' + idx">
            @for (tm of (tiposMedicion$ | async); track tm.idTipoMedicion) {
              <option [value]="tm.idTipoMedicion">{{ tm.nombre }}</option>
            }
          </select>
        }
      }

      <!-- 🔹 Si es Actuador -->
      @if (tipoSeleccionadoNombre === 'actuador') {
        <label>Letra para ON:</label>
        <input type="text" [(ngModel)]="letraOn" name="letraOn" maxlength="1" />

        <label>Letra para OFF:</label>
        <input type="text" [(ngModel)]="letraOff" name="letraOff" maxlength="1" />
      }

      <button type="submit">Guardar</button>
    </form>
  </div>
</div>
