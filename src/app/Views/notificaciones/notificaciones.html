<div class="notificaciones-container">
  <h2>Gestión de Notificaciones</h2>

  <div *ngIf="cargando$ | async" class="loading">
    <p>Cargando notificaciones...</p>
  </div>

  <div *ngIf="!(cargando$ | async)">
    <table class="tabla-notificaciones" *ngIf="notificaciones.length > 0; else noData">
      <thead>
        <tr>
          <th>Título</th>
          <th>Tipo Notificación</th>
          <th>Mensaje</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <!-- Ahora iteramos sobre la porción paginada -->
        <tr *ngFor="let notificacion of paginatedNotificaciones; let i = index; trackBy: trackByNotificacion"
            [class.no-leida]="!notificacion.leido"
            [class.leida]="notificacion.leido">
          <td (click)="abrirEnlace(notificacion)">{{ notificacion.idTituloNavigation?.titulo1 || 'Sin título' }}</td>
          <td (click)="abrirEnlace(notificacion)">{{ notificacion.idTipoNotificacionNavigation?.nombre || 'Sin tipo' }}</td>
          <td (click)="abrirEnlace(notificacion)">{{ notificacion.mensaje || '-' }}</td>
          <td>
            <!-- Solo aparece cuando la notificación ya está leída -->
            <button *ngIf="notificacion.leido"
                    (click)="eliminarNotificacion(notificacion.idNotificacion!, $event)"
                    class="btn-eliminar">
              Eliminar
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <ng-template #noData>
      <div class="no-data">
        <p>No hay notificaciones disponibles.</p>
      </div>
    </ng-template>

    <!-- Controles de paginación -->
    <div class="paginacion" *ngIf="notificaciones.length > pageSize">
      <button (click)="cambiarPagina(-1)" [disabled]="currentPage === 1">Anterior</button>
      <span>Página {{currentPage}} de {{totalPages}}</span>
      <button (click)="cambiarPagina(1)" [disabled]="currentPage === totalPages">Siguiente</button>
    </div>
  </div>
</div>
