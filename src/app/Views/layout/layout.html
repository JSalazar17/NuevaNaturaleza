<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">


<div class="container">
  <!-- üîπ Barra superior -->
  <header class="topbar">
    <div class="topbar-left  ">
      <button class="toggle-btn" (click)="toggleSidebar()">
        <i class="fas fa-bars"></i>
      </button>
      <img src="assets/logo_3_.png" alt="Logo" class="topbar-logo nodisp3" />
    </div>

    <div class="topbar-center">
      <h1>BIENVENIDOS LESTOMA</h1>
    </div>

    <!-- contenedor derecho de iconos -->
      <div class="topbar-right">
    <!-- üîî √çcono de notificaciones -->
     <div class="campana" (click)="toggleNotificaciones()">
    <i class="fa fa-bell"></i>
    <span *ngIf="noLeidasCount" class="badge"></span>
  </div>

  <!-- üë§ √çcono Usuario -->
    <div class="usuario-icon" (click)="togglePerfil()">
      <i class="fa fa-user"></i>
  </div>
  </div>

  <!-- üîΩ Panel de notificaciones -->
  <div *ngIf="mostrarNotis" class="panel-notis">
    <h4>Notificaciones</h4>
    
    <div *ngIf="notificaciones.length === 0" class="sin-noti">No hay notificaciones</div>

    <div *ngFor="let n of notificaciones" class="noti" [class.leida]="!n.leido" [class.no-leida]="n.leido">
      <p>{{n.mensaje}}</p>
      <div class="btns">
        <button (click)="eliminarNoti(n)">üóë</button>
        @if(!n.leido){
        <button (click)="marcarLeida(n)">‚úî</button>}
      </div>
    </div>
  </div>

  <!-- üìå Panel usuario -->
<div *ngIf="mostrarPerfil" class="panel-usuario">
  <p><b>Usuario:</b> {{usuario?.nombre}}</p>
  <p><b>Correo:</b> {{usuario?.correo}}</p>

  <button class="btn-editar-usuario" (click)="abrirEditarUsuario(); mostrarPerfil=false">
    ‚úè Editar Usuario
  </button>
</div>

  </header>

  <!-- üîπ Barra lateral -->
  <div class="sidebar" [class.collapsed]="isCollapsed">
    <ul class="menu">

      <li>
        <a routerLink="/gestion-dispositivos" (click)="toggleSidebar(true)">
          <i class="fas fa-network-wired"></i><span *ngIf="!isCollapsed">Gesti√≥n de Dispositivos</span>
        </a>
      </li>

      <!-- üîπ Submen√∫ -->
      <li class="submenu" [class.open]="submenuOpen === 'dispositivos'">
        <a href="javascript:void(0)" (click)="toggleSubmenu('dispositivos')">
          <i class="fas fa-microchip"></i>
          <span *ngIf="!isCollapsed">Dispositivos</span>
          <i class="fas fa-chevron-down flecha" *ngIf="!isCollapsed"></i>
        </a>

        <ul class="submenu-list" *ngIf="submenuOpen === 'dispositivos' && !isCollapsed">
          <li>
            <a routerLink="/sensores" (click)="toggleSidebar(true)">
              <i class="fas fa-thermometer-half"></i><span>Sensores</span>
            </a>
          </li>
          <li>
            <a routerLink="/actuadores" (click)="toggleSidebar(true)">
              <i class="fas fa-cogs"></i><span>Actuadores</span>
            </a>
          </li>
        </ul>
      </li>

      <li>
        <a routerLink="/checklist" (click)="toggleSidebar(true)">
          <i class="fas fa-clipboard-list"></i><span *ngIf="!isCollapsed">CheckList</span>
        </a>
      </li>
     
    @if(isAdmin()){
      <li>
        <a routerLink="/auditoria" (click)="toggleSidebar(true)">
          <i class="fas fa-search"></i><span *ngIf="!isCollapsed">Auditor√≠as</span>
        </a>
      </li>
      <li>
        <a routerLink="/eventos" (click)="toggleSidebar(true)">
          <i class="material-icons">event</i><span *ngIf="!isCollapsed">Eventos</span>
        </a>
      </li>
      <li>
        <a routerLink="/usuarios" (click)="toggleSidebar(true)">
          <i class="material-icons">account_box</i><span *ngIf="!isCollapsed">Usuarios</span>
        </a>
      </li>
      <li>
        <a routerLink="/sugerencias" (click)="toggleSidebar(true)">
          <i class="fas fa-lightbulb" ></i><span *ngIf="!isCollapsed">Sugerencias</span>
        </a>
      </li> 
    }
      <li class="notificaciones" (mouseenter)="mostrarPanel = true" (mouseleave)="mostrarPanel = false" [class.new]="hayNotificacionNueva"> 
        <a routerLink="/notificaciones" (click)="toggleSidebar(true)"> <i class="fas fa-bell"></i><span *ngIf="!isCollapsed">Notificaciones</span> </a> <span class="badge" *ngIf="hayNotificacionNueva"></span> </li> 

      <li>
        <a routerLink="/Iac"  (click)="toggleSidebar(true)">
          <i  class="material-icons">touch_app</i><span *ngIf="!isCollapsed">IA</span>
        </a>
      </li> 
    </ul>



    <button class="logout" (click)="logout()">
      <i class="fas fa-sign-out-alt"></i>
      <span *ngIf="!isCollapsed">Cerrar sesi√≥n</span>
    </button>
  </div>

  <!-- üîπ Contenido principal -->
  <div class="content" [class.collapsed-content]="isCollapsed"  (click)="toggleSidebar(true)">
    <div class="rcontent">
    <router-outlet></router-outlet></div>
     <div _ngcontent-ng-c1968843830="" class="buzon-flotante"  (click)="toggleBuzon()">
      <mat-icon><i class="material-icons">email</i></mat-icon>
    </div>
 <!-- Ventana emergente del buz√≥n -->
<div class="buzon-popup" *ngIf="mostrarBuzon">
  <div class="buzon-header">
    <h3>Buz√≥n de Sugerencias</h3>
    <button class="cerrar" (click)="toggleBuzon()">√ó</button>
  </div>

  <form (ngSubmit)="enviarSugerencia()">
    <input type="text" [(ngModel)]="sugerencia.usuario" name="usuario" placeholder="Tu nombre (opcional)">
    <input type="email" [(ngModel)]="sugerencia.correo" name="correo" placeholder="Tu correo (opcional)">
    <textarea [(ngModel)]="sugerencia.mensaje" name="mensaje" placeholder="Escribe tu sugerencia..." required></textarea>
    <button type="submit">Enviar</button>
  </form>

  <p *ngIf="mensajeExito" class="exito">{{ mensajeExito }}</p>
</div>
  </div>
    <!-- üîπ Barra inferior -->
    
 
     <footer class="bottombar">
    
      <img src="assets/logo_3_.png" alt="Logo" class="natubar-logo nodisp" />
          <!-- üîπ Pie con logos y textos -->


    <div class="bottombar-center">
      
      <p class="footer-text">
        <strong>Grupo de investigaci√≥n GISTFA</strong><br>
        Semillero de investigaci√≥n SERFAC<br><br>
        <span class="director">Director:</span>
        Jaime Eduardo Andrade Ram√≠rez<br><br>
      </p>
    <div class="footer-text nodisp3" >
        <span class="equipo">Equipo de desarrolladores:</span><br>
        Jorge Ivan Salazar Gomez<br>
        David Ricardo Contreras Espinoza
    </div>
    </div>
    
      <img src="assets/escudo.png" alt="Logo 2" class="footer-logo nodisp2" />

  </footer>
</div>
